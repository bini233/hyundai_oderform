<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<title>Parnas Hotel Collection Special Offer</title>

<style>
  /* 제품 디테일 상세페이지 영역 CSS 추가 */
  .desc-title{ font-weight:700; color:#2c3e50; margin-bottom:6px; }
  .desc-sub{ color:#556677; margin-bottom:12px; }
  .desc-section{ font-weight:700; color:#2c3e50; margin:12px 0 6px; }
  .desc-how{ font-weight:700; color:#2c3e50; margin:12px 0 6px; }
  .desc-list{ margin:0; padding-left:18px; color:#556677; line-height:1.7; }
  .desc-footnote{ margin-top:10px; font-size:0.92em; color:#778899; }

  /* ✅ 상단 안내(판매기간/구매방법/배송/오프라인/문의) 강조 박스 */
  .info-box{
    text-align: center;
    margin: 18px 0 10px;
    padding: 16px 16px;
    background: #ffffff;
    border: 1px solid #cfd6dd;
    border-radius: 10px;
    color: #2c3e50;
    line-height: 1.7;
  }
  
  .info-box .info-title{
    font-weight: 700;
    margin-bottom: 10px;
  }
  
  .info-box .info-item{
    margin: 6px 0;
    color: #556677;
  }
  
  .info-box .info-item strong{
    color: #2c3e50;
    font-weight: 700;
  }
  
  .info-box .info-sub{
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid #e4e9ef;
    color: #556677;
    font-size: 0.95em;
  }


  
  /* ✅ 계좌이체 안내 강조 박스 */
  /* ✅ 카드결제 안내 박스(은행 박스와 동일 톤) */
  .pay-highlight{
    margin-top: 12px;
    padding: 14px 16px;
    background: #f7f9fb;
    border: 1px solid #cfd6dd;
    border-radius: 10px;
    color: #2c3e50;
    line-height: 1.6;
  }
  
  .pay-highlight .pay-note{
    margin-top: 6px;
    font-size: 0.92em;
    color: #556677;
  }
    
  .bank-highlight{
    margin-top: 12px;
    padding: 14px 16px;
    background: #f7f9fb;
    border: 1px solid #cfd6dd;
    border-radius: 10px;
    color: #2c3e50;
    line-height: 1.6;
  }
  
  .bank-highlight .bank-name{
    font-weight: 700;
  }
  
  .bank-highlight .bank-amount{
    margin-top: 6px;
    font-weight: 700;
    font-size: 1.05em;
  }
  
  .bank-highlight .bank-note{
    margin-top: 6px;
    font-size: 0.92em;
    color: #556677;
  }


  
  body {
    font-family: 'Noto Sans KR', sans-serif;
    margin: 0;
    padding: 20px;
    background: #F7F7F7;
    display: flex;
    justify-content: center;
  }

  .page-wrapper {
    max-width: 1200px;
    width: 100%;
    background: #fff;
    padding: 25px;
    border-radius: 8px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.06);
  }

  /* 배너 (절대 잘리지 않게 수정) */
  .banner {
    width: 100%;
    border-radius: 8px;
    margin-bottom: 30px;
    overflow: hidden;
  }

  .banner img {
    width: 100%;
    height: auto;
    object-fit: contain;
    display: block;
  }

  h1 {
    text-align: center;
    font-size: 2em;
    color: #2c3e50;
    margin-bottom: 10px;
  }

  h4 {
    text-align: center;
    color: #555;
    margin-top: 0;
    margin-bottom: 30px;
  }

  .info-line {
    text-align: center;
    font-size: 0.95em;
    color: #666;
    line-height: 1.6;
  }

  .info-line a {
    color: inherit;
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  .note{
    display: inline-block;
    margin-top: 6px;
    font-size: 0.92em;
    color: #445566;
  }

  h2 {
    margin-top: 45px;
    font-size: 1.2em;
    border-left: 3px solid #b0c4de;
    padding-left: 10px;
    color: #2c3e50;
  }

  label {
    display: block;
    font-weight: 500;
    margin: 16px 0 6px;
  }

  /* ✅ input만 기존 라인 스타일 유지 (select는 분리) */
  input[type="text"],
  input[type="number"]{
    width: 100%;
    padding: 10px 0;
    border: none;
    border-bottom: 1px solid #ccc;
    background: transparent;
  }

  input:focus {
    border-bottom: 1px solid #2c3e50;
    outline: none;
  }

  /* ✅ Select(드롭다운) 디자인 개선 */
  select {
    width: 100%;
    padding: 12px 42px 12px 12px;
    border: 1px solid #cfd6dd;           /* 선명한 스트로크 */
    border-radius: 8px;
    background-color: #fff;
    color: #2c3e50;
    font-size: 0.95em;
    line-height: 1.2;

    appearance: none;                     /* 기본 화살표 제거 */
    -webkit-appearance: none;
    -moz-appearance: none;

    /* 커스텀 화살표 */
    background-image:
      linear-gradient(45deg, transparent 50%, #2c3e50 50%),
      linear-gradient(135deg, #2c3e50 50%, transparent 50%),
      linear-gradient(to right, transparent, transparent);
    background-position:
      calc(100% - 18px) 50%,
      calc(100% - 12px) 50%,
      0 0;
    background-size:
      6px 6px,
      6px 6px,
      100% 100%;
    background-repeat: no-repeat;

    transition: border-color 0.15s ease, box-shadow 0.15s ease;
  }

  select:hover {
    border-color: #2c3e50;
  }

  select:focus {
    outline: none;
    border-color: #2c3e50;
    box-shadow: 0 0 0 3px rgba(44, 62, 80, 0.12);
  }

  select::-ms-expand { display: none; }

  /* 상품 리스트 */
  .flex-container {
    display: flex;
    gap: 25px;
    margin-top: 25px;
  }

  .product-side {
    width: 40%;
    border-right: 1px solid #eee;
    padding-right: 15px;
  }

  .preview-side {
    width: 60%;
    padding-left: 15px;
  }

  .category-title {
    margin-top: 20px;
    font-weight: 600;
    padding-bottom: 5px;
    border-bottom: 1px solid #ddd;
    color: #222;
  }

  /* 상품 리스트 row 개선 */
  .product-row {
    display: grid;
    grid-template-columns: 1fr 120px 60px; /* 수량 칸 좁게 조정 */
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid #f3f3f3;
    gap: 20px; /* 칼럼 간 간격 넓힘 */
    cursor: pointer;
  }

  .product-row:hover {
    background: #fafafa;
  }

  .product-name {
    font-weight: 500;
  }

  .product-price {
    text-align: right;
    font-size: 0.95em;
  }

  .product-qty input {
    width: 100%;
    max-width: 55px;
    padding: 4px 6px;
    border: 1px solid #ccc;
    border-radius: 4px;
    text-align: center;
    font-size: 0.9em;
    background: #fff;
  }

  /* 상세영역 */
  .detail-title {
    font-size: 1.3em;
    font-weight: 600;
    margin-bottom: 15px;
  }

  .detail-img{
    width: 100%;
    height: 400px;
    object-fit: cover;       /* 프레임 꽉 채움 */
    background: #fafafa;
    border-radius: 6px;
    display: block;
  }


  .detail-desc {
    background: #fafafa;
    padding: 15px;
    border-radius: 6px;
    margin-bottom: 15px;
    color: #555;
    line-height: 1.5;
  }

  .total-box {
    margin-top: 20px;
    padding: 15px;
    background: #fafafa;
    border-radius: 6px;
    font-weight: 600;
    border: 1px solid #ddd;
  }

  /* ✅ 개인정보 동의 박스 */
  .consent-box{
    margin-top: 28px;
    padding: 16px 16px;
    background: #f7f9fb;
    border: 1px solid #cfd6dd;
    border-radius: 10px;
    color: #2c3e50;
    line-height: 1.65;
  }
  
  .consent-title{
    font-weight: 700;
    margin-bottom: 10px;
  }
  
  .consent-section{
    padding-top: 12px;
    margin-top: 12px;
    border-top: 1px solid #e4e9ef;
  }
  
  .consent-section:first-child{
    border-top: none;
    margin-top: 0;
    padding-top: 0;
  }
  
  .consent-subtitle{
    font-weight: 700;
    margin-bottom: 6px;
  }
  
  .consent-list{
    margin: 0;
    padding-left: 18px;
    color: #556677;
    font-size: 0.95em;
  }
  
  .consent-check{
    display: flex;
    gap: 10px;
    align-items: flex-start;
    margin-top: 10px;
    padding-top: 8px;
  }
  
  .consent-check input[type="checkbox"]{
    margin-top: 4px;
    width: 18px;
    height: 18px;
    accent-color: #2c3e50;
  }
  
  .consent-check label{
    margin: 0;
    font-weight: 600;
    color: #2c3e50;
  }
  
  .consent-required{
    font-size: 0.9em;
    color: #556677;
    margin-top: 6px;
  }


  button[type="submit"] {
    width: 100%;
    padding: 16px;
    background: #2c3e50;
    color: #fff;
    border: none;
    border-radius: 6px;
    margin-top: 35px;
  }

  button[type="submit"]:hover {
    background: #fff;
    color: #2c3e50;
    border: 1px solid #2c3e50;
  }

  .hidden { display:none; }

  /* 모바일 전용 상품 선택 */
  .mobile-product-selector {
    display: none;
    margin-top: 15px;
    margin-bottom: 20px;
  }

  /* 모바일에서 상품선택 select 약간 강조(선택) */
  .mobile-product-selector select{
    font-weight: 500;
  }

  @media(max-width:768px){
      h1 { font-size: 1.6em; margin-bottom: 8px; }
    .flex-container { flex-direction: column; }
    .product-side { display: none; }
    .preview-side { width:100%; padding-left:0; }
    .mobile-product-selector { display:block; }
  }
</style>
</head>

<body>
<div class="page-wrapper">

  <!-- 배너 -->
  <div class="banner">
    <img src="./assets/header.png" alt="Parnas Hotel Collection">
  </div>

  <h1>Parnas Hotel Collection Special Offer</h1>
  <h4>파르나스호텔 컬렉션이 현대 임직원분들에게만 특별 할인 혜택을 드립니다!</h4>

  <div class="info-box">
  
    <div class="info-item"><strong>판매 기간</strong> : ~ 2026.12.31</div>
    <div class="info-item"><strong>구매 방법</strong> : 계좌이체 또는 카드 결제 링크</div>
  
    <div class="info-item"><strong>배송 안내</strong></div>
    <div class="info-item">✓ 상품 배송은 영업일 기준 순차적으로 발송됩니다. (주말, 공휴일 제외)</div>
    <div class="info-item">✓ 기상악화 및 공휴일, 설/추석 연휴 등의 사유로 배송이 지연될 수 있습니다.</div>
  
    <div class="info-sub">
      <div class="info-item"><strong>오프라인 구매</strong> : 그랜드 인터컨티넨탈 서울 파르나스 1층 파르나스호텔 컬렉션 부티크</div>
      <div class="info-item">※ 오프라인 구매 시에만 사원증 또는 명함 확인이 필요합니다.</div>
    </div>
  
    <div class="info-item"><strong>문의</strong> : <a href="mailto:newbiz@parnas.co.kr">newbiz@parnas.co.kr</a></div>
  </div>


  <form action="https://formspree.io/f/xyzanddw" method="POST" onsubmit="return validateForm();">

    <!-- 1. 주문자 -->
    <h2>1. 주문자 정보</h2>

    <label>주문자 이름</label>
    <input type="text" name="주문자 이름" placeholder="예시: 홍길동" required>

    <label>회사 이메일 주소</label>
    <input type="text" name="회사 이메일 주소" placeholder="임직원 여부 확인용입니다. 예시: honggildong@company.com" required>

    <!-- 2. 상품 -->
    <h2>2. 구매 상품 및 수량</h2>

    <!-- 모바일 버전 상품 선택 -->
    <div class="mobile-product-selector">
      <label>상품 선택</label>
      <select id="mobileProductSelect"></select>
    </div>

    <div class="flex-container">

      <!-- 왼쪽 상품 리스트 -->
      <div class="product-side" id="productList"></div>

      <!-- 오른쪽 상세 -->
      <div class="preview-side">
        <div class="detail-title" id="detailTitle">상품을 선택해주세요</div>

        <img id="detailImg" class="detail-img" src="https://via.placeholder.com/600x240?text=상품이미지" alt="상품 이미지">

        <div class="detail-desc" id="detailDesc">좌측 또는 드롭다운에서 상품을 선택해주세요.</div>

        <div>단가: <span id="detailPrice">0</span>원</div>
        <div>현재 상품 금액: <span id="detailSubtotal">0</span>원</div>

        <label>수량 조정</label>
        <input type="number" id="detailQty" min="0" value="0">
      </div>
    </div>

    <div class="total-box">총액: <span id="grandTotal">0</span>원</div>

    <!-- 3. 배송 -->
    <h2>3. 배송 정보</h2>

    <label>수취인 이름</label>
    <input type="text" name="수취인 이름" placeholder="예시: 홍길동" required>

    <label>수취인 전화번호</label>
    <input type="text" name="수취인 전화번호" class="phone-input" inputmode="numeric" placeholder="예시: 01012345678" required>

    <label>수취인 주소</label>
    <input type="text" name="수취인 주소" placeholder="예시: 서울시 강남구" required>

    <!-- 4. 결제 -->
    <h2>4. 결제 방식</h2>

    <label>결제 방식 선택</label>
    <select name="결제 방식" id="paySelect" required>
      <option value="">선택</option>
      <option value="계좌이체">계좌이체</option>
      <option value="카드결제">카드결제</option>
    </select>

    <div id="bankArea" class="hidden">
    
      <!-- ✅ 계좌이체 안내 강조 박스 -->
      <div class="bank-highlight" id="bankHighlight">
        <div class="bank-name">입금 계좌: 하나은행 183-910001-24105</div>
        <div class="bank-amount">입금하실 금액은 <span id="bankTotalText">0</span>원 입니다.</div>
        <div class="bank-note">결제 확인 후, 영업일 기준으로 순차 출고됩니다.</div>
      </div>
    
      <label>입금자명</label>
      <input type="text" name="입금자명" placeholder="예시: 홍길동">
    
      <label>입금 금액</label>
      <input type="text" id="depositAmount" name="입금 금액" inputmode="numeric" placeholder="총금액과 동일하게 입력">
    </div>


    <div id="cardArea" class="hidden">
    
      <!-- 카드결제 안내 강조 박스 -->
      <div class="pay-highlight" id="cardHighlight">
        카드 결제하실 수 있는 결제 링크를 입력해주신 전화번호로 보내드릴 예정입니다.
        <div class="pay-note">결제 확인 후, 영업일 기준으로 순차 출고됩니다.</div>
      </div>
    
      <label>결제 링크 받을 번호</label>
      <input type="text" name="카드결제 연락처" class="phone-input" placeholder="숫자만 입력">
    </div>


    <!-- 5. 증빙 -->
    <h2>5. 현금영수증 / 세금계산서</h2>

    <label>발행 선택</label>
    <select id="taxSelect" name="증빙 선택">
      <option value="">선택 안 함</option>
      <option value="현금영수증">현금영수증(개인)</option>
      <option value="세금계산서">세금계산서(기업)</option>
    </select>

    <div id="taxArea" class="hidden">
      <div id="cashArea" class="hidden">
        <label>현금영수증 휴대폰 번호</label>
        <input type="text" id="cashPhone" name="현금영수증 번호" class="phone-input" placeholder="숫자만 입력">
      </div>

      <div id="invoiceArea" class="hidden">
        <label>사업자 등록번호 (10자리)</label>
        <input type="text" id="businessNo" name="사업자등록번호" maxlength="10" class="phone-input" placeholder="숫자만 입력">
      </div>
    </div>

    <!-- Formspree hidden -->
    <input type="hidden" name="주문 내역" id="orderSummaryInput">
    <input type="hidden" name="총액" id="totalAmountInput">
    
    <!-- ✅ 개인정보 동의 -->
    <div class="consent-box">
      <div class="consent-title">개인정보 동의</div>
    
      <div class="consent-section">
        <div class="consent-subtitle">1) 개인정보 수집 및 이용 동의</div>
        <ul class="consent-list">
          <li>수집하는 개인정보 항목: 주문자 이름, 수취인 이름, 수취인 연락처, 수취인 주소</li>
          <li>수집 및 이용 목적: 파르나스호텔 컬렉션 상품 주문 취합 및 배송</li>
          <li>보유 및 이용기간: 배송 완료 후 1개월간 보관 후 폐기</li>
        </ul>
    
        <div class="consent-check">
          <input type="checkbox" id="agreeCollect" required>
          <label for="agreeCollect">개인정보 수집 및 이용에 동의합니다. (필수)</label>
        </div>
      </div>
    
      <div class="consent-section">
        <div class="consent-subtitle">2) 개인정보 제3자 제공 동의</div>
        <ul class="consent-list">
          <li>제공받는 자: 물플</li>
          <li>제공받는 자의 이용 목적: 파르나스호텔 컬렉션 상품 배송</li>
          <li>제공하는 항목: 수취인 이름, 수취인 연락처, 수취인 주소</li>
          <li>제공받는 자의 보유 및 이용기간: 배송 완료 후 1개월간 보관 후 폐기</li>
        </ul>
    
        <div class="consent-check">
          <input type="checkbox" id="agreeThirdParty" required>
          <label for="agreeThirdParty">개인정보 제3자 제공에 동의합니다. (필수)</label>
        </div>
      </div>
    
      <div class="consent-required">※ 필수 동의 항목에 체크해야 주문서 제출이 가능합니다.</div>
    </div>


    <button type="submit">주문서 제출하기</button>
  </form>
</div>

<script>
/* ----- 상품 데이터 ----- */
const products = [
  { category:"Scent Line", name:"Mossy Wood 디퓨저", price:80750,
    img: "./assets/Mossy_Wood_Diffuser.png",
    desc: `
    <div class="desc-title">향기로 전하는 품격, Mossy Wood</div>
    <div class="desc-sub">은은하게 퍼지는 풍부한 아이리스 향과 세련된 우디 노트로 럭셔리한 품격을 전합니다.</div>
    
    <div class="desc-section">상품 구성</div>
    <ul class="desc-list">
      <li>디퓨저 본품 200ml</li>
      <li>리필 용액 100ml</li>
      <li>리드 스틱 8개</li>
    </ul>
    
    <div class="desc-footnote">* 패키지 상자와 선물 포장용 쇼핑백이 함께 제공됩니다.</div>
    `
  },
      
  { category:"Scent Line", name:"Mossy Wood 캔들", price:79050,
    img: "./assets/Mossy_Wood_Candle.png",
    desc: `
    <div class="desc-title">향기로 전하는 품격, Mossy Wood</div>
    <div class="desc-sub">은은하게 퍼지는 풍부한 아이리스 향과 세련된 우디 노트로 럭셔리한 품격을 전합니다.</div>
    
    <div class="desc-section">상품 구성</div>
    <ul class="desc-list">
      <li>캔들 본품 220g</li>
    </ul>

    <div class="desc-how">사용 방법</div>
    <ul class="desc-list">
      <li>1. 최초 사용 시, 심지를 곧게 세운 후 불을 붙여 주세요.</li>
      <li>2. 캔들의 윗면이 골고루 녹을 때까지 약 2~3시간 정도 캔들을 태워 주세요.</li>
      <li>3. 사용 후에는 불꽃을 완전히 꺼 주시기 바랍니다.</li>
    
    <div class="desc-footnote">* 패키지 상자와 선물 포장용 쇼핑백이 함께 제공됩니다.</div>
    `
  },

  { category:"Scent Line", name:"Mossy Wood 룸스프레이", price:74800,
    img: "./assets/Mossy_Wood_Roomspray.png",
    desc:"뿌리기만 하면 호텔처럼 정돈된 향을 느낄 수 있습니다." },

  { category:"Scent Line", name:"Mint Forest 디퓨저", price:80750,
    img: "./assets/Mint_Forest_Diffuser.png",
    desc: `
    <div class="desc-title">공간을 감싸는 고요한 싱그러움, Mint Forest</div>
    <div class="desc-sub">제주의 맑고 부드러운 바람, 푸른 바다의 감동을 향기로 전합니다.</div>
    
    <div class="desc-section">상품 구성</div>
    <ul class="desc-list">
      <li>디퓨저 본품 200ml</li>
      <li>리필 용액 100ml</li>
      <li>리드 스틱 8개</li>
    </ul>
    
    <div class="desc-footnote">* 패키지 상자와 선물 포장용 쇼핑백이 함께 제공됩니다.</div>
    `
  },

  { category:"Scent Line", name:"Mint Forest 캔들", price:79050,
    img: "./assets/Mint_Forest_Candle.png",
    desc:"초록빛 숲 향이 은은하게 퍼지는 캔들." },

  { category:"Scent Line", name:"Mint Forest 룸스프레이", price:74800,
    img: "./assets/Mint_Forest_Roomspray.png",
    desc:"빠르게 분위기를 바꾸는 산뜻한 룸스프레이." },

  { category:"Scent Line", name:"White Bloom 디퓨저", price:80750,
    img: "./assets/White_Bloom_Diffuser.png",
    desc: `
    <div class="desc-title">고요함 속에서 피어나는 깊은 평온, White Bloom</div>
    <div class="desc-sub">상쾌한 아침 햇살같은 이탈리안 베르가모트와 포근한 담요처럼 감싸오는 머스크와 앰버의 잔향으로, 잔잔한 활력이 공간을 채웁니다.</div>
    
    <div class="desc-section">상품 구성</div>
    <ul class="desc-list">
      <li>디퓨저 본품 200ml</li>
      <li>리필 용액 100ml</li>
      <li>리드 스틱 8개</li>
    </ul>
    
    <div class="desc-footnote">* 패키지 상자와 선물 포장용 쇼핑백이 함께 제공됩니다.</div>
    `
  },

  { category:"Scent Line", name:"White Bloom 캔들", price:79050,
    img: "./assets/White_Bloom_Candle.png",
    desc:"잔잔한 꽃향이 오래 지속되는 캔들." },

  { category:"Scent Line", name:"White Bloom 룸스프레이", price:74800,
    img: "./assets/White_Bloom_Roomspray.png",
    desc:"부드러운 플로럴향 룸스프레이." },

  { category:"Bedding Line", name:"구스다운 킹 이불세트", price:1050000,
    img: "./assets/Duvet_K.png",
    desc:"풍성한 볼륨감의 구스다운 킹 이불세트." },

  { category:"Bedding Line", name:"구스다운 퀸 이불세트", price:1008000,
    img: "./assets/Duvet_Q.png",
    desc:"포근하게 감싸주는 구스다운 퀸 이불세트." },

  { category:"Bedding Line", name:"구스다운 싱글 이불세트", price:840000,
    img: "./assets/Duvet_S.png",
    desc:"부드러운 싱글 사이즈 구스다운 이불." },

  { category:"Bedding Line", name:"베드시트 킹", price:189000,
    img: "./assets/Bed_Sheet_K.png",
    desc:"부드러운 촉감의 킹 사이즈 베드시트." },

  { category:"Bedding Line", name:"베드시트 퀸", price:175000,
    img: "./assets/Bed_Sheet_Q.png",
    desc:"산뜻한 촉감의 퀸 사이즈 베드시트." },

  { category:"Bedding Line", name:"베드시트 싱글", price:147000,
    img: "./assets/Bed_Sheet_S.png",
    desc:"깔끔한 싱글 사이즈 베드시트." },

  { category:"Bedding Line", name:"구스다운 프리미엄 베개세트", price:368000,
    img: "./assets/Pillow_Premium.png",
    desc:"프리미엄 볼륨의 구스다운 베개 세트." },

  { category:"Bedding Line", name:"구스다운 킹 베개세트", price:316000,
    img: "./assets/Pillow_King.png",
    desc:"넉넉한 킹 사이즈 구스다운 베개." },

  { category:"Towel Line", name:"배스로브", price:129500,
    img: "./assets/Bathrobe.png",
    desc:"호텔 스타일의 포근한 배스로브." },

  { category:"Towel Line", name:"배스 타월 세트", price:80500,
    img: "./assets/Bathtowel.png",
    desc:"흡수력 좋은 배스 타월 2개 세트." },

  { category:"Towel Line", name:"페이스 타월 세트", price:63200,
    img: "./assets/FaceTowel.png",
    desc:"부드러운 페이스 타월 3개 세트." }
];

let selectedIndex = 0;
let total = 0;

/* ----- 상품 리스트 만들기 ----- */
const productList = document.getElementById("productList");
let lastCategory = "";

products.forEach((p, index) => {
  if (p.category !== lastCategory) {
    const cat = document.createElement("div");
    cat.className = "category-title";
    cat.textContent = p.category;
    productList.appendChild(cat);
    lastCategory = p.category;
  }

  const row = document.createElement("div");
  row.className = "product-row";
  row.dataset.index = index;

  row.innerHTML = `
    <div class="product-name">${p.name}</div>
    <div class="product-price">${p.price.toLocaleString()}원</div>
    <div class="product-qty">
      <input type="number" min="0" value="0" class="qty-input" data-index="${index}">
    </div>
  `;

  productList.appendChild(row);
});

/* ----- 모바일 드롭다운 채우기 ----- */
const mobileSelect = document.getElementById("mobileProductSelect");
products.forEach((p, i) => {
  const op = document.createElement("option");
  op.value = i;
  op.textContent = `${p.category} - ${p.name}`;
  mobileSelect.appendChild(op);
});

/* ----- 상품 클릭 (PC) ----- */
document.querySelectorAll(".product-row").forEach(row => {
  row.addEventListener("click", () => {
    selectProduct(parseInt(row.dataset.index));
  });
});

/* ----- 모바일 상품 선택 ----- */
mobileSelect.addEventListener("change", e => {
  selectProduct(parseInt(e.target.value));
  document.querySelector(".preview-side").scrollIntoView({ behavior: "smooth" });
});

/* ----- 상세 업데이트 ----- */
/* ----- 수량 입력 UX 개선: 포커스 시 전체 선택 ----- */
/* ----- 금액 입력: 천단위 콤마 표시 ----- */
function formatWithComma(value){
  const onlyNumber = (value || "").toString().replace(/[^\d]/g, "");
  if (!onlyNumber) return "";
  return parseInt(onlyNumber, 10).toLocaleString();
}

const depositInput = document.getElementById("depositAmount");
if (depositInput){
  depositInput.addEventListener("input", () => {
    const cursorFromEnd = depositInput.value.length - depositInput.selectionStart;
    depositInput.value = formatWithComma(depositInput.value);
    // 커서 위치 최대한 자연스럽게 유지
    const newPos = Math.max(0, depositInput.value.length - cursorFromEnd);
    depositInput.setSelectionRange(newPos, newPos);
  });
}

  
function attachQtySelectAll(){
  // 왼쪽 리스트 수량 input들
  document.querySelectorAll(".qty-input").forEach(input => {
    input.addEventListener("focus", () => input.select());
    input.addEventListener("click", () => input.select());
  });

  // 상세 수량 input
  const detailQty = document.getElementById("detailQty");
  detailQty.addEventListener("focus", () => detailQty.select());
  detailQty.addEventListener("click", () => detailQty.select());
}

attachQtySelectAll();
  
function selectProduct(i) {
  selectedIndex = i;
  const p = products[i];

  document.getElementById("detailTitle").innerText = p.name;
  document.getElementById("detailImg").src = p.img;
  document.getElementById("detailDesc").innerHTML = p.desc;
  document.getElementById("detailPrice").innerText = p.price.toLocaleString();

  const q = document.querySelector(`.qty-input[data-index="${i}"]`).value || 0;
  document.getElementById("detailQty").value = q;

  document.getElementById("detailSubtotal").innerText = (p.price * q).toLocaleString();
}

/* ----- 숫자만 입력 ----- */
document.querySelectorAll(".phone-input").forEach(input=>{
  input.addEventListener("input",()=> input.value = input.value.replace(/\D/g,""));
});

/* ----- 수량 → 총액 ----- */
function calcTotal(){
  total = 0;
  products.forEach((p,i)=>{
    let q = parseInt(document.querySelector(`.qty-input[data-index="${i}"]`).value) || 0;
    total += p.price * q;
  });
  document.getElementById("grandTotal").innerText = total.toLocaleString();

    // ✅ 계좌이체 안내 박스 총액도 업데이트
  const bankTotalEl = document.getElementById("bankTotalText");
  if (bankTotalEl) bankTotalEl.innerText = total.toLocaleString();
}


/* 양방향 싱크 */
document.addEventListener("input", e => {
  if (e.target.classList.contains("qty-input")) {
    if (parseInt(e.target.dataset.index) === selectedIndex)
      document.getElementById("detailQty").value = e.target.value;
    calcTotal();
  }

  if (e.target.id === "detailQty") {
    document.querySelector(`.qty-input[data-index="${selectedIndex}"]`).value = e.target.value;
    calcTotal();
  }
});

/* ----- 결제 방식 토글 ----- */
document.getElementById("paySelect").addEventListener("change", e => {
  const v = e.target.value;
  document.getElementById("bankArea").classList.toggle("hidden", v !== "계좌이체");
  document.getElementById("cardArea").classList.toggle("hidden", v !== "카드결제");
});

/* ----- 증빙 토글 ----- */
document.getElementById("taxSelect").addEventListener("change", e => {
  const v = e.target.value;
  document.getElementById("taxArea").classList.toggle("hidden", v === "");

  document.getElementById("cashArea").classList.toggle("hidden", v !== "현금영수증");
  document.getElementById("invoiceArea").classList.toggle("hidden", v !== "세금계산서");
});

/* ----- 최종 검증 + Formspree로 전송할 요약 생성 ----- */
function validateForm(){
  calcTotal();

  if (total <= 0){
    alert("한 개 이상의 상품을 선택해주세요.");
    return false;
  }

  // ✅ 개인정보 동의 필수 체크
  const agreeCollect = document.getElementById("agreeCollect").checked;
  const agreeThirdParty = document.getElementById("agreeThirdParty").checked;

  if (!agreeCollect || !agreeThirdParty) {
    alert("개인정보 동의(수집·이용 / 제3자 제공)는 필수입니다. 체크 후 제출해주세요.");
    return false;
  }


  const pay = document.getElementById("paySelect").value;

  if (pay === "계좌이체"){
    const depositor = document.querySelector('input[name="입금자명"]').value.trim();
    const depositAmount = parseInt(
      document.getElementById("depositAmount").value.replace(/[^\d]/g,""),
      10
    );
    if (!depositAmount || depositAmount !== total){
      alert("입금 금액이 총액과 일치해야 합니다.");
      return false;
    }

    if (!depositor){
      alert("입금자명을 입력해주세요.");
      return false;
    }
    if (depositAmount !== total){
      alert("입금 금액이 총액과 일치해야 합니다.");
      return false;
    }
  }

  if (pay === "카드결제"){
    const phone = document.querySelector('input[name="카드결제 연락처"]').value.trim();
    if (!phone){
      alert("결제 링크 받을 번호를 입력해주세요.");
      return false;
    }
  }



  

  /* 주문 요약 텍스트 생성 */
  let lines = [];
  products.forEach((p,i)=>{
    let q = parseInt(document.querySelector(`.qty-input[data-index="${i}"]`).value) || 0;
    if (q > 0)
      lines.push(`- ${p.name} x ${q}개 = ${(p.price*q).toLocaleString()}원`);
  });

  const buyer = document.querySelector('input[name="주문자 이름"]').value.trim();

  let summary =
`주문자: ${buyer}
총액: ${total.toLocaleString()}원

주문 내역:
${lines.join("\n")}`;

  document.getElementById("orderSummaryInput").value = summary;
  document.getElementById("totalAmountInput").value = total;

  return confirm(summary + "\n\n주문 내용이 맞습니까?");
}

/* 초기 표시 */
selectProduct(0);
calcTotal();
</script>

</body>
</html>
